<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TokoKita</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .card img { height: 180px; object-fit: cover; }
    .card-title { font-size: 1rem; }
    .navbar-brand { font-weight: bold; color: white; }
    .category-btn { margin: 0 5px 10px 0; }
    .nav-link { color: white !important; }
    .navbar-toggler { padding: 0.25rem 0.4rem; font-size: 0.875rem; line-height: 1; width: 36px; height: 36px; }
    .product-image { max-height: 400px; object-fit: cover; width: 100%; }
    .navbar-brand img {  height: 30px;  width: auto; }

  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-danger bg-danger sticky-top p-2">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="#" onclick="showListing()">
        <img src="logo.png" alt="Logo" height="30" class="me-2" />
        <span class="text-white">Umma Raudan</span>
      </a>
            <button class="navbar-toggler bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarMenu">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="#" onclick="showListing()">Beranda</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showCaraPesan()">Cara Pesan</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Tanya Jawab</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showKontakKami()">Kontak Kami</a></li>
        </ul>
        <input id="searchInput" class="form-control w-50 me-2" placeholder="Cari produk..." oninput="filterProduk()" />
      </div>
    </div>
  </nav>

  <!-- Listing Section -->
  <div id="listingSection" class="container mt-3">
    <div id="kategoriList" class="mb-2"></div>
    <select id="sortSelect" class="form-select w-auto mb-3" onchange="filterProduk()">
      <option value="">Urutkan</option><option value="asc">Harga Terendah</option><option value="desc">Harga Tertinggi</option>
    </select>
    <div class="row" id="produk-list"><div class="text-center w-100">Memuat produk...</div></div>
  </div>

  <!-- Detail Section -->
  <div id="detailSection" class="container mt-4" style="display:none">
    <button class="btn btn-secondary mb-3" onclick="showListing()">‚Üê Kembali</button>
    <div id="detailProduk" class="row"></div>
  </div>

  <!-- Cara Pesan Section -->
<div id="caraPesanSection" class="container mt-4" style="display:none">
  <h2 class="mb-3">Cara Pemesanan</h2>
  <p>Toko Umma Raudan berkomitmen untuk membuat pengalaman pemesanan undangan pernikahan menjadi mudah dan menyenangkan. Berikut langkah-langkah lengkap untuk memesan undangan pernikahan di Umma Raudan.</p>
  <ol>
    <li><strong>Pilih Paket</strong><br>Pilih paket undangan yang sesuai dengan keinginan Anda.</li>
    <li><strong>Konsultasi (Opsional)</strong><br>Jika ada pertanyaan, hubungi customer service kami untuk konsultasi langsung.</li>
    <li><strong>Lakukan Pemesanan</strong><br>Klik "Pesan Sekarang" di halaman produk, maka akan dibawa menuju ke aplikasi WhatsApp Anda, dan berikan informasi terkait paket undangan yang Anda inginkan.</li>
    <li><strong>Pembayaran 1 (DP 50%)</strong><br>Lakukan down payment sebesar 50% dari total harga pesanan.</li>
    <li><strong>Lengkapi Data Pernikahan</strong><br>Setelah DP, kamu akan menerima invoice dan formulir data pernikahan dalam bentuk Google Form.</li>
    <li><strong>Proses Desain dan Revisi</strong><br>Tim desainer kami akan mengirim draft desain. Revisi bisa dilakukan hingga finalisasi desain.</li>
    <li><strong>Pembayaran 2 (Pelunasan)</strong><br>Lakukan pelunasan (sisa dari pembayaran pertama).</li>
    <li><strong>Produksi & Pengiriman</strong><br>Undangan diproduksi dan dikirim sesuai jadwal paket yang dipilih.</li>
  </ol>
</div>

<!-- Kontak Kami Section -->
<div id="kontakKamiSection" class="container mt-4" style="display:none">
  <h2 class="mb-3">Kontak Kami</h2>
  <p>Hubungi kami melalui platform berikut:</p>
  <div class="d-flex flex-column gap-3">
    <a href="https://wa.me/6289609745090" target="_blank" class="btn btn-success d-flex align-items-center" style="max-width:300px">
      <i class="bi bi-whatsapp fs-4 me-2"></i> WhatsApp: 0896-0974-5090
    </a>
    <a href="https://www.instagram.com/ummaraudan" target="_blank" class="btn btn-danger d-flex align-items-center" style="max-width:300px">
      <i class="bi bi-instagram fs-4 me-2"></i> Instagram: @ummaraudan
    </a>
    <a href="https://www.facebook.com/franika.korompot.7" target="_blank" class="btn btn-primary d-flex align-items-center" style="max-width:300px">
      <i class="bi bi-facebook fs-4 me-2"></i> Facebook: Franika Korompot
    </a>
  </div>
</div>



  <!-- Order Modal -->
  <div class="modal fade" id="orderModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Form Pemesanan</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="orderForm">
            <div class="mb-3">
              <label class="form-label">Nama</label>
              <input type="text" class="form-control" id="custName" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Nomor HP</label>
              <input type="text" class="form-control" id="custPhone" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Alamat</label>
              <textarea class="form-control" id="custAddress" rows="2" required></textarea>
            </div>
            <hr>
            <div class="mb-3">
              <label class="form-label">Jumlah Order</label>
              <input type="number" class="form-control" id="orderQty" min="1" value="50" required>
            </div>
            <!-- Order Summary -->
            <h4 id="orderProdNameText"></h4>
            <h5 id="orderUnitPriceText"></h5>
            <p>Jumlah Order: <span id="orderQtyText"></span></p>
            <hr>
            <h4 id="orderTotalPriceText"></h4>
            <button type="submit" class="btn btn-primary">Kirim</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const appsScriptURL = "https://script.google.com/macros/s/AKfycbzTSN5GdU6TnFflUYhfO1IPqBVO9wIf_UNEnLZdpXLYf7xQICw10Iv9hCW2wHQVDdb6hQ/exec";
    let produk = [], kategoriAktif = '', currentItem = null;
    const orderModal = new bootstrap.Modal(document.getElementById('orderModal'));

    async function loadProduk() {
      try {
        const res = await fetch(appsScriptURL);
        produk = await res.json();
        tampilkanKategori(); filterProduk();
      } catch {
        document.getElementById('produk-list').innerHTML = "<div class='text-center w-100 text-danger'>Gagal memuat produk.</div>";
      }
    }

    function tampilkanKategori() {
      const list = document.getElementById('kategoriList');
      const uniq = [...new Set(produk.map(p => p.kategori))];
      list.innerHTML = `<button class='btn btn-outline-secondary category-btn ${kategoriAktif===''?'active':''}' onclick='setKategori("")'>Semua</button>`;
      uniq.forEach(k => list.innerHTML += `<button class='btn btn-outline-secondary category-btn ${kategoriAktif===k?'active':''}' onclick='setKategori("${k}")'>${k}</button>`);
    }

    function setKategori(k) { kategoriAktif = k; tampilkanKategori(); filterProduk(); }

    function tampilkanProduk(data) {
      const row = document.getElementById('produk-list'); row.innerHTML = '';
      if (!data.length) { row.innerHTML = "<div class='text-center w-100'>Produk tidak ditemukan.</div>"; return; }
      data.forEach(item => {
        row.innerHTML += `
          <div class='col-12 col-md-3 mb-4'>
            <div class='card h-100' style='cursor:pointer' onclick='showDetail(${item.id})'>
              <img src='${item.gambar}' class='card-img-top' onerror="this.src='https://via.placeholder.com/300x180?text=No+Image'" />
              <div class='card-body d-flex flex-column'>
                <h5 class='card-title'>${item.nama}</h5>
                <p class='card-text'>Rp ${parseInt(item.harga500).toLocaleString()}</p>
                <button class='btn btn-primary mt-auto' onclick='openOrderModal(event, ${item.id})'>Pesan Sekarang</button>
              </div>
            </div>
          </div>`;
      });
    }

    function openOrderModal(evt, id) {
      evt.stopPropagation();
      currentItem = produk.find(p => p.id === id);
      document.getElementById('orderForm').reset();
      setOrderDetails(1);
      document.getElementById('orderQty').oninput = () => setOrderDetails(parseInt(document.getElementById('orderQty').value) || 1);
      orderModal.show();
    }

    async function setOrderDetails(qty) {
      const res = await fetch(`${appsScriptURL}?jumlah=${qty}`);
      const data = await res.json();
      const prod = data.find(p => p.id === currentItem.id);
      const unitPrice = prod.harga;
      const totalPrice = unitPrice * qty;
      document.getElementById('orderProdNameText').textContent = prod.nama;
      document.getElementById('orderUnitPriceText').textContent = `Rp ${unitPrice.toLocaleString()}`;
      document.getElementById('orderQtyText').textContent = qty;
      document.getElementById('orderTotalPriceText').textContent = `Total: Rp ${totalPrice.toLocaleString()}`;
    }

    document.getElementById('orderForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const name = document.getElementById('custName').value.trim();
      const address = document.getElementById('custAddress').value.trim();
      const qty = parseInt(document.getElementById('orderQty').value);
      orderModal.hide();
      const res = await fetch(`${appsScriptURL}?jumlah=${qty}`);
      const data = await res.json();
      const prod = data.find(p => p.id === currentItem.id);
      const unitPrice = prod.harga;
      const totalPrice = unitPrice * qty;
      const msg = encodeURIComponent(
        `hai min, saya ${name} dari ${address} ingin memesan ${qty} pcs produk ${prod.kategori} ${prod.nama} (Harga satuan: Rp ${unitPrice.toLocaleString()}, Total: Rp ${totalPrice.toLocaleString()})\n${prod.gambar}`
      );
      window.open(`https://wa.me/6289609745090?text=${msg}`, '_blank');
    });

    function showDetail(id) {
      document.getElementById('listingSection').style.display='none';
      document.getElementById('detailSection').style.display='block';
      const item = produk.find(p => p.id === id); currentItem = item;
      const div = document.getElementById('detailProduk');
      div.innerHTML = `
        <div class='col-md-6'>
          <img src='${item.gambar}' class='product-image rounded'/>
        </div>
        <div class='col-md-6'>
          <h2>${item.nama}</h2>
          <p class='text-muted'>Kategori: ${item.kategori}</p>
          <h4>Rp ${item.harga500.toLocaleString()}</h4>
          <p class='mt-3'>${item.deskripsi.replace(/\n/g, '<br>')}</p>
          <button class='btn btn-primary mt-3' onclick='openOrderModal(event, ${item.id})'>Pesan Sekarang</button>
        </div>
        <div class='col-12 mt-5'><h3>Rekomendasi Lainnya</h3><div class='row' id='recommendation'></div></div>`;
      const recDiv = document.getElementById('recommendation');
      const rec = produk.filter(p => p.kategori===item.kategori && p.id!==item.id).slice(0,4);
      recDiv.innerHTML=''; rec.forEach(p => recDiv.innerHTML += `
        <div class='col-12 col-sm-6 col-md-3 mb-4'>
          <div class='card h-100' onclick='showDetail(${p.id})' style='cursor:pointer'>
            <img src='${p.gambar}' class='card-img-top'/>
            <div class='card-body'>
              <h6 class='card-title'>${p.nama}</h6>
              <p class='card-text'>Rp ${parseInt(p.harga).toLocaleString()}</p>
              <button class='btn btn-primary' onclick='openOrderModal(event, ${p.id})'>Pesan Sekarang</button>
            </div>
          </div>
        </div>`);
    }

    function showListing() {
      document.getElementById('detailSection').style.display='none';
      document.getElementById('caraPesanSection').style.display='none';
      document.getElementById('kontakKamiSection').style.display='none';
      document.getElementById('listingSection').style.display='block';
      filterProduk();
    }



    function filterProduk() {
      const kw = document.getElementById('searchInput').value.toLowerCase();
      const s = document.getElementById('sortSelect').value;
      let res = produk.filter(p => p.nama.toLowerCase().includes(kw) && (kategoriAktif? p.kategori===kategoriAktif : true));
      if (s==='asc') res.sort((a,b)=>a.harga-b.harga);
      else if (s==='desc') res.sort((a,b)=>b.harga-a.harga);
      tampilkanProduk(res);
    }

    window.onload = loadProduk;




    function showCaraPesan() {
      document.getElementById('listingSection').style.display = 'none';
      document.getElementById('detailSection').style.display = 'none';
      document.getElementById('caraPesanSection').style.display = 'block';
    }

    function showKontakKami() {
      document.getElementById('listingSection').style.display = 'none';
      document.getElementById('detailSection').style.display = 'none';
      document.getElementById('caraPesanSection').style.display = 'none';
      document.getElementById('kontakKamiSection').style.display = 'block';
    }

  </script>
</body>
</html>
